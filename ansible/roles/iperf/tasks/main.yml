- name: Start IPerf server container
  docker_container:
    name: iperf
    image: networkstatic/iperf3
    command: iperf3 -6s
    state: started
  when: is_iperf_server is defined

- name: Start IPerf client container
  docker_container:
    name: iperf
    image: networkstatic/iperf3
    command: iperf3 -6c {{ iperf_server }}
  register: iperf_output
  when: iperf_server is not defined

- debug: msg={{ iperf_output.stdout }}
  when: iperf_server is not defined
